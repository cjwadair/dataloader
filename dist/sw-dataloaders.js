(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";function setStorageInstances(e){storageInstances=e,console.log("storageInstances are: ",storageInstances)}function handleFetchEvent(e){var t=swCheckCacheParams(e.request.url);t?(console.info("handleFetchRequest starting for: ",e.request.url),e.respondWith(swProcessRequest(e,t).then(function(t){return console.log("handleFetchEvent successfully resolved",e.request.url),t}).catch(function(t){throw console.log("handleFetchEvent failed to resolve successfully",t,e.request.url),t}))):console.debug("no cache matches found for "+e.request.url+". Proceeding with regular fetch.")}function swCheckCacheParams(e){for(var t in storageInstances){var r=storageInstances[t],n=!1;if(r.url.filter(function(t){if(e.match(t))return void(n=!0)}),n)return r}}function swProcessRequest(e,t){return new Promise(function(r,n){var o=requestHandler[t.requestMethod];o(e,t).then(function(t){if("object"!=("undefined"==typeof t?"undefined":_typeof(t))&&console.info("swProcessRequest is returning a: ","undefined"==typeof t?"undefined":_typeof(t),e.request.url),t)return console.info("swProcessRequest resolving: ",t),r(formatResponse(o,t));throw console.warn("swProcessRequest did not resolve. throwing error now",e.request.url),Error}).catch(function(t){return console.info("swProcessRequest rejecting",e.request.url),n(t)})})}function formatResponse(e,t){var r={status:200,statusText:"OK",headers:{"Content-Type":"text/plain"}};return t.constructor==Response?(console.debug("formatResponse: object is response object",t),t):(console.debug(t.text,"undefined"==typeof t?"undefined":_typeof(t),t),t.text().then(function(e){var t=new Response(e,r);return t}))}function swCacheFirst(e,t){return new Promise(function(r,n){caches.match(e.request.url).then(function(o){if(o)return console.info(e.request.url+" returning from the cache",o),r(o);console.info("swCacheFirst starting network request",e.request.url);var s=new Promise(function(e){var r=1e3*t.maxAge||2e3;setTimeout(e,r,"network request failed to respond")}),c=new Promise(function(r,n){return swRequestFromNetwork(e,t).then(function(t){return console.info(e.request.url+" returning from the network directly from swRequestFromNetwork"),r(t)}).catch(function(t){return console.info("swCacheFirst: network request error being caught",e.request.url),n(t)})});Promise.race([s,c]).then(function(t){return console.info("swCacheFirst: "+e.request.url+" returning from the network via Promise.race"),r(t)}).catch(function(t){return console.info("swCacheFirst request rejected because timeout triggered",t,e.request.url),n(t)})}).catch(function(t){console.error("error in swCacheFirst request",t,e.request.url),n(t)})})}function swCacheOnly(e,t){return new Promise(function(t,r){caches.match(e.request).then(function(e){return e?t(e):r()})})}function swNetworkFirst(e,t){var r=void 0,n=new Promise(function(t,n){r=setTimeout(function(){caches.match(e.request).then(function(e){return e?(console.log("returning swNetworkFirst request from the Cache","undefined"==typeof e?"undefined":_typeof(e),e),t(e)):(console.warn("no response to resolve to in swNetworkFirst"),n())})},1500)}),o=new Promise(function(n,o){return swRequestFromNetwork(e,t).then(function(t){return r&&clearTimeout(r),console.log("returning swNetworkFirst request from the Network",e.request,e.request.url),caches.match(e.request).then(function(e){console.log("matching cache is:",e)}),t?n(t):(console.warn("swNetworkFirst: Bad Response From networkRequest"),o())}).catch(function(t){return console.log("swNetworkFirst: error returned from requestFromNetwork",t,e.request.url),r&&clearTimeout(r),caches.match(e.request).then(function(e){return e?(console.log("returning swNetworkFirst request from the Cache","undefined"==typeof e?"undefined":_typeof(e),e),n(e)):(console.warn("no response to resolve to in swNetworkFirst"),o())})})});return Promise.race([n,o]).then(function(e){return e})}function swNetworkOnly(e,t){return new Promise(function(r,n){swRequestFromNetwork(e,t,!1).then(function(e){return e?r(e):(console.log("swNetworkOnly Request did not succeed. The response was: "+e),r)}).catch(function(e){console.debug("swNetworkOnly request failed"),n(Error(e))})})}function swFastest(e,t){return new Promise(function(r,n){var o=!1,s=function(e){o?n(Error("both cache and network requests failed"),e):(console.log("rejected request"),o=!0)},c=function(e){return e?r(e):void s()};swCacheOnly(e,t).then(c,s),swRequestFromNetwork(e,t).then(c,s)})}function swRequestFromNetwork(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return new Promise(function(n,o){fetch(e.request).then(function(o){console.debug("swRequestFromNetwork: network request responded with: ",e.request.url,o.headers,o.headers.get("Content-Type")),caches.open(t.cacheName).then(function(s){return r&&"GET"===e.request.method&&s.add(e.request.url).then(function(){console.debug("swRequestFromNetwork: network item added to cache",e.request.url),cleanUpCache(t,s,e.request.url)}).catch(function(t){console.error("swRequestFromNetwork: error when adding item to the cache",e.request.url,t)}),n(o)})}).catch(function(t){return console.error("error in swRequestFromNetwork: ",t,e.request.url),o(t)})})}function cleanUpCache(e,t,r){console.log("offline status",navigator.offline);var n=Date.now();idbManager.openDb(e.cacheName).then(function(e){return idbManager.setTimestampForUrl(e,r,n)}).then(function(t){return idbManager.expireEntries(t,e.maxEntries,e.maxAge,n)}).then(function(r){var n=r.map(function(r){return console.log("deleting cache: ",r,e.maxAge),t.delete(r)});return Promise.all(n).then(function(){console.log("Done with cache cleanup.")})}).catch(function(e){console.log("error in cache clean up: ",e)})}Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};exports.setStorageInstances=setStorageInstances,exports.handleFetchEvent=handleFetchEvent;var idbManager=require("./utils/dataloader-cache-expiration"),storageInstances={},requestHandler={networkFirst:swNetworkFirst,cacheFirst:swCacheFirst,fastest:swFastest,networkOnly:swNetworkOnly,cacheOnly:swCacheOnly};caches.keys().then(function(e){console.log("current caches are: ",e)});

},{"./utils/dataloader-cache-expiration":2}],2:[function(require,module,exports){
"use strict";function openDb(e){return new Promise(function(n,r){var t=indexedDB.open(DB_PREFIX+e,DB_VERSION);t.onupgradeneeded=function(){console.log("onupgradeneeded called");var e=t.result.createObjectStore(STORE_NAME,{keyPath:URL_PROPERTY});e.createIndex(TIMESTAMP_PROPERTY,TIMESTAMP_PROPERTY,{unique:!1})},t.onsuccess=function(){n(t.result)},t.onerror=function(){r(t.error)}})}function setTimestampForUrl(e,n,r){return new Promise(function(t,o){var i=e.transaction(STORE_NAME,"readwrite"),u=i.objectStore(STORE_NAME);u.put({url:n,timestamp:r}),i.oncomplete=function(){t(e)},i.onabort=function(){o(i.error)}})}function expireOldEntries(e,n,r){return n?new Promise(function(t,o){var i=1e3*n,u=[],s=e.transaction(STORE_NAME,"readwrite"),c=s.objectStore(STORE_NAME),E=c.index(TIMESTAMP_PROPERTY);E.openCursor().onsuccess=function(e){var n=e.target.result,t=r-n.value[TIMESTAMP_PROPERTY];if(n&&t>i){var o=n.value[URL_PROPERTY];u.push(o),c.delete(o),n.continue()}},s.oncomplete=function(){t(u)},s.onabort=o}):Promise.resolve([])}function expireExtraEntries(e,n){return n?new Promise(function(r,t){var o=[],i=e.transaction(STORE_NAME,"readwrite"),u=i.objectStore(STORE_NAME),s=u.index(TIMESTAMP_PROPERTY),c=s.count();s.count().onsuccess=function(){var e=c.result;e>n&&(s.openCursor().onsuccess=function(r){var t=r.target.result;if(t){var i=t.value[URL_PROPERTY];o.push(i),u.delete(i),e-o.length>n&&t.continue()}})},i.oncomplete=function(){r(o)},i.onabort=t}):Promise.resolve([])}function expireEntries(e,n,r,t){return expireOldEntries(e,r,t).then(function(r){return expireExtraEntries(e,n).then(function(e){return r.concat(e)})})}var DB_PREFIX="",DB_VERSION=1,STORE_NAME="dataStore",URL_PROPERTY="url",TIMESTAMP_PROPERTY="timestamp";module.exports={openDb:openDb,setTimestampForUrl:setTimestampForUrl,expireEntries:expireEntries};

},{}]},{},[1]);
